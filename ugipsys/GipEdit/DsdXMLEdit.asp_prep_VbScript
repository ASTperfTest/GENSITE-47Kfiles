























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































     alert "Cx_0dummy"
'     window.history.back
 <script language=vbs></script>     </body>     </html>Cx_0dummy 
























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































     alert "<%=errmsg%>"
'     window.history.back
 <script language=vbs></script>     </body>     </html><%end sub '---- showdonebox() ---- %> 
<%
 
sub activity1action(actiontype, thisicuitem, thisieditor)

 '---題目上線加分,  若已有討論的內容, 也要將討論的人加分
 '---題目下線扣分, 

 dim memberexistflag, questioncheckgrade
 memberexistflag = false
 questioncheckgrade = 0
 
 thissql = "select * from activitymembernew where memberid = '" & thisieditor & "'"
 set thisrs = conn.execute(thissql)
 if not thisrs.eof then
  memberexistflag = true 
  questioncheckgrade = thisrs("questioncheckgrade")
 end if
 set thisrs = nothing
 
 if actiontype = "add" then  
  '---member exist---add grade---
  if memberexistflag = true then 
   thissql = "update activitymembernew set questioncheckgrade = questioncheckgrade + 2 where memberid = '" & thisieditor & "'"
  else '---member not exist---add member---
   thissql = "insert into activitymembernew(memberid, questioncheckgrade) values('" & thisieditor & "', 2)"
  end if
  conn.execute(thissql) 
  
  '---檢查有沒有討論的, 若已有討論的.將人加分...
  sql = "select * from cudtgeneric inner join knowledgeforum "
  sql = sql & "on cudtgeneric.icuitem = knowledgeforum.gicuitem "
  sql = sql & "where parenticuitem = " & thisicuitem 
  set thisrs = conn.execute(sql)  
  while not thisrs.eof
   
   sql = "select * from activitymembernew where memberid = '" & thisrs("ieditor") & "'"
   set temprs = conn.execute(sql)
   if not temprs.eof then
    thissql = "update activitymembernew set discusscheckgrade = discusscheckgrade + 2 where memberid = '" & thisrs("ieditor") & "'"
   else
    thissql = "insert into activitymembernew(memberid, discusscheckgrade) values('" & thisrs("ieditor") & "', 2)"
   end if
   set temprs = nothing
   conn.execute(thissql)
   
   thisrs.movenext
  wend
  set thisrs = nothing
  
 elseif actiontype = "del" then
  if questioncheckgrade >= 2 then
   thissql = "update activitymembernew set questioncheckgrade = questioncheckgrade - 2 where memberid = '" & thisieditor & "'"
   conn.execute(thissql)
  end if   
 end if

end sub
 
 %> 
 